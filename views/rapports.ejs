<!-- Système d'onglets -->
<div class="tabs-container">
    <div class="tabs-header">
        <button class="tab-btn active" data-tab="proprietaire">
            <i class="fas fa-user-tie"></i> Propriétaire
        </button>
        <button class="tab-btn" data-tab="locataire">
            <i class="fas fa-user"></i> Locataire
        </button>
    </div>

    <!-- Onglet Propriétaire -->
    <div class="tab-content active" id="proprietaire">
        <!-- Barre d'outils -->
        <div class="toolbar">
            <div class="filter-container">
                <select id="periodeFilter" class="filter-select">
                    <option value="3">3 derniers mois</option>
                    <option value="6">6 derniers mois</option>
                    <option value="12">12 derniers mois</option>
                    <option value="24">2 dernières années</option>
                    <option value="60">5 dernières années</option>
                </select>
                <select id="proprieteFilter" class="filter-select">
                    <option value="all">Toutes les propriétés</option>
                    <option value="appartement">Appartements</option>
                    <option value="studio">Studios</option>
                    <option value="maison">Maisons</option>
                </select>
                <button class="btn-primary" id="exportBtn">
                    <i class="fas fa-download"></i> Exporter
                </button>
            </div>
        </div>

        <!-- Statistiques globales -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-info">
                    <h3>Revenus Totaux</h3>
                    <p class="stat-number" id="revenusTotaux">FCFA 0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="stat-info">
                    <h3>Taux d'Occupation</h3>
                    <p class="stat-number" id="tauxOccupation">0%</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-building"></i>
                </div>
                <div class="stat-info">
                    <h3>Propriétés Actives</h3>
                    <p class="stat-number" id="proprietesActives">0</p>
                </div>
            </div>
            <!--<div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-trending-up"></i>
                </div>
                <div class="stat-info">
                    <h3>Croissance</h3>
                    <p class="stat-number" id="croissance">+0%</p>
                </div>
            </div>-->
        </div>

        <!-- Graphiques -->
        <div class="charts-container">
            <!-- Graphique global des revenus -->
            <div class="chart-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-area"></i> Évolution des Revenus Globaux</h2>
                </div>
                <div class="chart-container">
                    <canvas id="revenusGlobauxChart"></canvas>
                    <!-- Faux graphique en arrière-plan pour les plans basiques -->
                    <% if (pagePermissions && !pagePermissions.viewAdvancedReports?.allowed) { %>
                        <div class="fake-chart-background" id="fakeRevenusGlobauxChart"></div>
                        <div class="chart-overlay">
                            <div class="upgrade-overlay-content">
                                <div class="upgrade-icon">
                                    <i class="fas fa-crown"></i>
                                </div>
                                <h3>Rapports avancés non disponibles</h3>
                                <p>Accédez aux graphiques détaillés et aux analyses avancées avec un plan supérieur.</p>
                                <div class="upgrade-actions">
                                    <a href="/parametres?tab=billing" class="btn btn-primary">
                                        <i class="fas fa-arrow-up"></i> Mettre à niveau
                                    </a>
                                </div>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Graphiques par propriété -->
            <div class="chart-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> Analyse par Propriété</h2>
                </div>
                <div class="chart-container">
                    <div class="properties-charts" id="propertiesCharts">
                        <!-- Les graphiques par propriété seront générés ici -->
                    </div>
                    <!-- Faux graphiques en arrière-plan pour les plans basiques et standard -->
                    <% if (pagePermissions && !pagePermissions.viewPropertyReports?.allowed) { %>
                        <div class="fake-properties-charts" id="fakePropertiesCharts">
                            <!-- Les faux graphiques par propriété seront générés ici -->
                        </div>
                        <div class="chart-overlay">
                            <div class="upgrade-overlay-content">
                                <div class="upgrade-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <h3>Analyse par propriété non disponible</h3>
                                <p>Visualisez les performances détaillées de chaque propriété avec un plan Premium ou supérieur.</p>
                                <div class="upgrade-actions">
                                    <a href="/parametres?tab=billing" class="btn btn-primary">
                                        <i class="fas fa-arrow-up"></i> Mettre à niveau
                                    </a>
                                </div>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <!-- Onglet Locataire -->
    <div class="tab-content" id="locataire">
        <!-- Barre d'outils -->
        <div class="toolbar">
            <div class="filter-container">
                <select id="periodeFilterLocataire" class="filter-select">
                    <option value="3">3 derniers mois</option>
                    <option value="6">6 derniers mois</option>
                    <option value="12">12 derniers mois</option>
                    <option value="24">2 dernières années</option>
                    <option value="60">5 dernières années</option>
                </select>
                <button class="btn-primary" id="exportLocataireBtn">
                    <i class="fas fa-download"></i> Exporter
                </button>
            </div>
        </div>

        <!-- Statistiques globales -->
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-euro-sign"></i>
                </div>
                <div class="stat-info">
                    <h3>Dépenses Totales</h3>
                    <p class="stat-number" id="depensesTotales">FCFA 0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-home"></i>
                </div>
                <div class="stat-info">
                    <h3>Propriétés Louées</h3>
                    <p class="stat-number" id="proprietesLouees">0</p>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-calendar-check"></i>
                </div>
                <div class="stat-info">
                    <h3>Paiements à Jour</h3>
                    <p class="stat-number" id="paiementsAJour">0</p>
                </div>
            </div>
            <!--<div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-trending-down"></i>
                </div>
                <div class="stat-info">
                    <h3>Économies</h3>
                    <p class="stat-number" id="economies">FCFA 0</p>
                </div>
            </div>-->
        </div>

        <!-- Graphiques -->
        <div class="charts-container">
            <!-- Graphique global des dépenses -->
            <div class="chart-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-area"></i> Évolution des Dépenses de Location</h2>
                </div>
                <div class="chart-container">
                    <canvas id="depensesGlobauxChart"></canvas>
                    <!-- Faux graphique en arrière-plan pour les plans basiques -->
                    <% if (pagePermissions && !pagePermissions.viewAdvancedReports?.allowed) { %>
                        <div class="fake-chart-background" id="fakeDepensesGlobauxChart"></div>
                        <div class="chart-overlay">
                            <div class="upgrade-overlay-content">
                                <div class="upgrade-icon">
                                    <i class="fas fa-crown"></i>
                                </div>
                                <h3>Rapports avancés non disponibles</h3>
                                <p>Accédez aux graphiques détaillés et aux analyses avancées avec un plan supérieur.</p>
                                <div class="upgrade-actions">
                                    <a href="/parametres?tab=billing" class="btn btn-primary">
                                        <i class="fas fa-arrow-up"></i> Mettre à niveau
                                    </a>
                                </div>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>

            <!-- Graphiques par propriété louée -->
            <div class="chart-section">
                <div class="section-header">
                    <h2><i class="fas fa-chart-bar"></i> Analyse par Propriété Louée</h2>
                </div>
                <div class="chart-container">
                    <div class="properties-charts" id="locatairePropertiesCharts">
                        <!-- Les graphiques par propriété seront générés ici -->
                    </div>
                    <!-- Faux graphiques en arrière-plan pour les plans basiques et standard -->
                    <% if (pagePermissions && !pagePermissions.viewPropertyReports?.allowed) { %>
                        <div class="fake-properties-charts" id="fakeLocatairePropertiesCharts">
                            <!-- Les faux graphiques par propriété seront générés ici -->
                        </div>
                        <div class="chart-overlay">
                            <div class="upgrade-overlay-content">
                                <div class="upgrade-icon">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <h3>Analyse par propriété non disponible</h3>
                                <p>Visualisez les performances détaillées de chaque propriété avec un plan Premium ou supérieur.</p>
                                <div class="upgrade-actions">
                                    <a href="/parametres?tab=billing" class="btn btn-primary">
                                        <i class="fas fa-arrow-up"></i> Mettre à niveau
                                    </a>
                                </div>
                            </div>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- eslint-disable-next-line -->
<script>
    // eslint-disable-next-line
    // @ts-ignore
    // eslint-disable-next-line no-undef
    window.rapportsData = <%- JSON.stringify(rapportsData) %>;
    // eslint-disable-next-line
    // @ts-ignore
    // eslint-disable-next-line no-undef
    window.pagePermissions = <%- JSON.stringify(pagePermissions || {}) %>;
    // eslint-disable-next-line
    // @ts-ignore
    // eslint-disable-next-line no-undef
    window.userBillingPlan = <%- JSON.stringify(userBillingPlan || {}) %>;
    console.log('Données passées depuis le contrôleur:', window.rapportsData);
    console.log('Permissions de facturation:', window.pagePermissions);
</script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="/js/rapports.js"></script> 