<!-- Menu latéral -->
<nav class="sidebar" id="sidebar">
    <div class="sidebar-header">
        <h2><img src="/images/bikorent-logo.png" alt="BikoRent" class="logo-img"> BikoRent</h2>
        <button class="close-btn-sidebar" id="closeSidebar">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Contenu scrollable du sidebar -->
    <div class="sidebar-content">
        <ul class="sidebar-menu">
            <li class="sb_home">
                <a href="/"><i class="fas fa-home"></i> Accueil</a>
            </li>
            <li class="sb_dashboard ">
                <a href="/dashboard"><i class="fas fa-chart-line"></i> Dashboard</a>
            </li>
            <li class="sb_proprietes ">
                <a href="/proprietes"><i class="fas fa-building"></i> Propriétés</a>
            </li>
            <li class="sb_locataires">
                <a href="/locataires"><i class="fas fa-users"></i> Locataires</a>
            </li>
            <li class="sb_paiements">
                <a href="/paiements"><i class="fas fa-credit-card"></i> Paiements</a>
            </li>
            <li class="sb_rapports">
                <a href="/rapports"><i class="fas fa-chart-bar"></i> Rapports</a>
            </li>
        <li class="sb_chat">
            <a href="/chat">
                <i class="fas fa-comments"></i> Chat
                <span class="badge" id="unreadMessagesBadge" style="display: none;">0</span>
            </a>
        </li>
        <% if (typeof calendarAutomationActive !== 'undefined' && calendarAutomationActive) { %>
        <li class="sb_calendrier">
            <a href="/calendrier"><i class="fas fa-calendar-alt"></i> Calendrier</a>
        </li>
        <% } %>
        <% if (typeof automationConnected !== 'undefined' && automationConnected) { %>
        <li class="sb_automatisations">
            <a href="/automatisations"><i class="fas fa-bolt"></i> Automatisations</a>
        </li>
        <% } %>
        <li class="sb_parametres">
            <a href="/parametres"><i class="fas fa-cog"></i> Paramètres</a>
        </li>
        </ul>
    </div>
    
    <!-- Section de déconnexion -->
    <div class="sidebar-footer">
        <div class="user-profile">
            <div class="user-avatar">
                <i class="fas fa-user-circle"></i>
            </div>
            <div class="user-details">
                <span class="user-name">
                    <% 
                    let userName = '';
                    let userEmail = '';
                    
                    if (locals.user) {
                        console.log('User data in sidebar:', locals.user);
                        console.log('User firstName:', locals.user.firstName);
                        console.log('User lastName:', locals.user.lastName);
                        //userName = locals.user.firstName + ' ' + locals.user.lastName;
                        //userName = 'oooooooooo';
                        //console.log('userName2:', userName);
                        
                        //userEmail = locals.user.email;
                        
                        
                        // Vérifier différentes structures possibles
                        if (locals.user.firstName && locals.user.lastName) {
                            userName = locals.user.firstName + ' ' + locals.user.lastName;
                            console.log('Using firstName + lastName:', userName);
                        } else if (locals.user.name) {
                            userName = locals.user.name;
                            console.log('Using name:', userName);
                        } else if (locals.user.profile && locals.user.profile.firstName && locals.user.profile.lastName) {
                            userName = locals.user.profile.firstName + ' ' + locals.user.profile.lastName;
                            console.log('Using profile firstName + lastName:', userName);
                        }
                        
                        if (locals.user.email) {
                            userEmail = locals.user.email;
                        } else if (locals.user.profile && locals.user.profile.email) {
                            userEmail = locals.user.profile.email;
                        }
                        
                        console.log('Final userName:', userName);
                        console.log('Final userEmail:', userEmail);
                    }
                    console.log('userName:', userName);
                    
                    %>
                    <%= userName %>
                </span>
                <span class="user-email"><%= userEmail %></span>
            </div>
        </div>
        <button class="logout-btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i>
            <span>Déconnexion</span>
        </button>
    </div>
</nav>

<!-- Modal de confirmation de déconnexion -->
<div class="modal sidebar-modal" id="logoutModal">
    <div class="modal-content small">
        <div class="modal-header">
            <h3>
                <i class="fas fa-sign-out-alt" style="color: var(--danger-color); margin-right: 0.5rem;"></i>
                Confirmation de déconnexion
            </h3>
            <button class="close-modal" id="closeLogoutModal">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="confirmation-content">
                <div class="confirmation-section">
                    <div class="warning-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="confirmation-text">
                        <h4>Êtes-vous sûr de vouloir vous déconnecter ?</h4>
                        <p>Vous devrez vous reconnecter pour accéder à nouveau à votre compte.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-actions">
            <button class="btn-secondary" id="cancelLogout">
                <i class="fas fa-times"></i>
                Annuler
            </button>
            <button class="btn-danger" id="confirmLogout">
                <i class="fas fa-sign-out-alt"></i>
                Se déconnecter
            </button>
        </div>
    </div>
</div> 